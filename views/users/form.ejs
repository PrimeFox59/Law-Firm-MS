<%- include('../partials/header') %>

<div class="container-fluid p-4 page-content">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="fw-semibold mb-1"><%= userData ? 'Edit User' : 'Add User' %></h2>
      <p class="text-muted mb-0">Only admins can manage users.</p>
    </div>
    <a href="/users" class="btn btn-outline-secondary"><i class="fas fa-arrow-left me-2"></i>Back</a>
  </div>

  <div class="glass-card p-4">
    <form method="POST" action="<%= userData ? '/users/' + userData.id + '?_method=PUT' : '/users' %>">
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Full Name *</label>
          <input type="text" class="form-control" name="full_name" value="<%= userData ? userData.full_name : '' %>" required>
        </div>
        <div class="col-md-6">
          <label class="form-label">Email *</label>
          <input type="email" class="form-control" name="email" value="<%= userData ? userData.email : '' %>" required>
        </div>
        <div class="col-md-6">
          <label class="form-label">Role *</label>
          <% const roles = (typeof roleOptions !== 'undefined' && roleOptions && roleOptions.length) ? roleOptions : [{ value: 'admin', label: 'admin' }, { value: 'attorney', label: 'attorney' }, { value: 'staff', label: 'staff' }, { value: 'client', label: 'client' }]; %>
          <select class="form-select" name="account_type" required>
            <% roles.forEach(r => { %>
              <option value="<%= r.value %>" <%= userData && userData.account_type === r.value ? 'selected' : '' %>><%= r.label %></option>
            <% }); %>
          </select>
        </div>
        <div class="col-md-6">
          <label class="form-label">Phone</label>
          <input type="text" class="form-control" name="phone" value="<%= userData ? userData.phone || '' : '' %>">
        </div>
        <div class="col-md-6">
          <label class="form-label">Company</label>
          <input type="text" class="form-control" name="company" value="<%= userData ? userData.company || '' : '' %>">
        </div>
        <div class="col-md-3">
          <label class="form-label">Hourly Rate</label>
          <input type="number" class="form-control" name="hourly_rate" step="0.01" value="<%= userData ? userData.hourly_rate || '' : '' %>">
        </div>
        <div class="col-md-6">
          <label class="form-label"><%= userData ? 'New Password (optional)' : 'Password *' %></label>
          <input type="password" class="form-control" name="password" <%= userData ? '' : 'required' %> minlength="6" placeholder="Minimum 6 characters">
          <% if (userData) { %><small class="text-muted">Leave blank to keep existing password.</small><% } %>
        </div>
      </div>

      <div class="mt-4 d-flex gap-2">
        <button type="submit" class="btn btn-gradient">
          <i class="fas fa-save me-2"></i><%= userData ? 'Update User' : 'Create User' %>
        </button>
        <a href="/users" class="btn btn-outline-secondary">Cancel</a>
      </div>
    </form>
  </div>
</div>

<%- include('../partials/footer') %>
